{"version":3,"file":"index.cjs","sources":["../src/DdcUri.ts","../src/DdcClient.ts"],"sourcesContent":["import type { BucketId } from '@cere-ddc-sdk/blockchain';\nimport { Cid } from '@cere-ddc-sdk/ddc';\n\nexport type DdcEntity = 'file' | 'dag-node';\n\nexport type DdcUriOptions = {\n  name?: string;\n};\n\n/**\n * A generic representation of a DDC URI.\n *\n * @template T The type of the entity. Must extend DdcEntity.\n */\nexport class DdcUri<T extends DdcEntity = DdcEntity> {\n  /**\n   * The Content Identifier (CID) of the entity.\n   */\n  readonly cid: string = '';\n\n  /**\n   * The name of the entity.\n   */\n  readonly name?: string;\n\n  /**\n   * The bucket identifier.\n   */\n  readonly bucketId: BucketId;\n\n  /**\n   * The type of the entity.\n   */\n  readonly entity: T;\n\n  constructor(bucketId: BucketId, cidOrName: string, entity: T, options?: DdcUriOptions) {\n    this.name = options?.name;\n    this.bucketId = bucketId;\n    this.entity = entity;\n\n    if (Cid.isCid(cidOrName)) {\n      this.cid = cidOrName;\n    } else {\n      this.name ??= cidOrName;\n    }\n  }\n\n  /**\n   * The CID or name of the entity.\n   */\n  get cidOrName() {\n    const cidOrName = this.cid || this.name;\n\n    if (!cidOrName) {\n      throw new Error('Invalid DdcUri: both CID and Name are empty');\n    }\n\n    return cidOrName;\n  }\n}\n\n/**\n * Represents a URI for a file in DDC.\n *\n * A FileUri extends the DdcUri class with the entity type set to 'file'.\n *\n * @group Files\n * @extends DdcUri<'file'>\n */\nexport class FileUri extends DdcUri<'file'> {\n  constructor(bucketId: BucketId, cidOrName: string, options?: DdcUriOptions) {\n    super(bucketId, cidOrName, 'file', options);\n  }\n}\n\n/**\n * Represents a URI for a DAG (Directed Acyclic Graph) node in DDC.\n *\n * A DagNodeUri extends the DdcUri class with the entity type set to 'dag-node'.\n *\n * @group Directed Acyclic Graph (DAG)\n * @extends DdcUri<'dag-node'>\n */\nexport class DagNodeUri extends DdcUri<'dag-node'> {\n  constructor(bucketId: BucketId, cidOrName: string, options?: DdcUriOptions) {\n    super(bucketId, cidOrName, 'dag-node', options);\n  }\n}\n","import {\n  DagNode,\n  DagNodeResponse,\n  Router,\n  Signer,\n  UriSigner,\n  DagNodeStoreOptions,\n  ConfigPreset,\n  DagNodeGetOptions,\n  DEFAULT_PRESET,\n  Logger,\n  createLogger,\n  bindErrorLogger,\n  NodeInterface,\n  BalancedNode,\n  AuthTokenParams,\n  AuthToken,\n  BalancedNodeConfig,\n  CnsRecordGetOptions,\n} from '@cere-ddc-sdk/ddc';\nimport { FileStorage, File, FileStoreOptions, FileResponse, FileReadOptions } from '@cere-ddc-sdk/file-storage';\nimport { AccountId, Blockchain, BucketId, BucketParams, ClusterId, Sendable } from '@cere-ddc-sdk/blockchain';\n\nimport { DagNodeUri, DdcUri, FileUri } from './DdcUri';\n\nexport type DdcClientConfig = Omit<BalancedNodeConfig, 'router'> &\n  Omit<ConfigPreset, 'blockchain'> & {\n    blockchain: Blockchain | ConfigPreset['blockchain'];\n  };\n\ntype DepositBalanceOptions = {\n  allowExtra?: boolean;\n};\n\n/**\n * `DdcClient` is a class that provides methods to interact with the DDC.\n *\n * It provides methods to manage buckets, grant access, and store and read files and DAG nodes.\n */\nexport class DdcClient {\n  private readonly ddcNode: NodeInterface;\n  private readonly blockchain: Blockchain;\n  private readonly fileStorage: FileStorage;\n  private readonly signer: Signer;\n  private readonly logger: Logger;\n\n  constructor(uriOrSigner: Signer | string, config: DdcClientConfig = DEFAULT_PRESET) {\n    const logger = createLogger('DdcClient', config);\n    const blockchain =\n      typeof config.blockchain === 'string' ? new Blockchain({ wsEndpoint: config.blockchain }) : config.blockchain;\n\n    const signer = typeof uriOrSigner === 'string' ? new UriSigner(uriOrSigner) : uriOrSigner;\n    const router = config.nodes\n      ? new Router({ signer, nodes: config.nodes, logger })\n      : new Router({ signer, blockchain, logger });\n\n    this.blockchain = blockchain;\n    this.signer = signer;\n    this.logger = logger;\n    this.ddcNode = new BalancedNode({ ...config, router, logger });\n    this.fileStorage = new FileStorage(router, { ...config, logger });\n\n    logger.debug(config, 'DdcClient created');\n\n    if (config.logErrors !== false) {\n      bindErrorLogger(this, this.logger, [\n        'getBalance',\n        'depositBalance',\n        'getDeposit',\n        'createBucket',\n        'getBucket',\n        'getBucketList',\n        'store',\n        'read',\n        'resolveName',\n      ]);\n    }\n  }\n\n  /**\n   * Creates a new instance of the DdcClient.\n   *\n   * @param uriOrSigner - A Signer instance or a [substrate URI](https://polkadot.js.org/docs/keyring/start/suri).\n   * @param config - Configuration options for the DdcClient. Defaults to TESTNET.\n   *\n   * @returns A promise that resolves to a new instance of the DdcClient.\n   *\n   * @example\n   *\n   * ```typescript\n   * const ddcClient = await DdcClient.create('//Alice', DEVNET);\n   * ```\n   *\n   * ```typescript\n   * const ddcClient = await DdcClient.create('//Alice', {\n   *   blockchain: 'wss://devnet.cere.network',\n   *   retries: 3,\n   * });\n   * ```\n   */\n  static async create(uriOrSigner: Signer | string, config: DdcClientConfig = DEFAULT_PRESET) {\n    const client = new DdcClient(uriOrSigner, config);\n\n    return client.connect();\n  }\n\n  async connect() {\n    await this.blockchain.isReady();\n\n    return this;\n  }\n\n  async disconnect() {\n    await this.blockchain.disconnect();\n\n    return this;\n  }\n\n  /**\n   * Retrieves the current free balance of the account.\n   *\n   * @returns A promise that resolves to the current balance of the account.\n   *\n   * @example\n   * ```typescript\n   * const balance = await ddcClient.getBalance();\n   *\n   * console.log(balance);\n   * ```\n   * */\n  async getBalance() {\n    this.logger.info('Getting the account balance %s', this.signer.address);\n    const balance = await this.blockchain.getAccountFreeBalance(this.signer.address);\n    this.logger.info('The account (%s) balance is %s', this.signer.address, balance);\n\n    return balance;\n  }\n\n  /**\n   * Deposits a specified amount of tokens to the account for a specific cluster. The account must have enough tokens to cover the deposit.\n   *\n   * @param clusterId - The ID of the cluster to deposit tokens for.\n   * @param amount - The amount of tokens to deposit.\n   * @param options - Additional options for the deposit.\n   *\n   * @returns A promise that resolves to the transaction hash of the deposit.\n   *\n   * @example\n   *\n   * ```typescript\n   * const clusterId: ClusterId = '0x...';\n   * const amount = 100n;\n   * const txHash = await ddcClient.depositBalance(clusterId, amount);\n   *\n   * console.log(txHash);\n   * ```\n   * */\n  async depositBalance(clusterId: ClusterId, amount: bigint, options: DepositBalanceOptions = {}) {\n    let tx: Sendable;\n    const currentDeposit =\n      options.allowExtra === false\n        ? null\n        : await this.blockchain.ddcCustomers.getStackingInfo(clusterId, this.signer.address);\n\n    if (currentDeposit === null) {\n      this.logger.info('Depositing balance %s to %s for cluster %s', amount, this.signer.address, clusterId);\n      tx = this.blockchain.ddcCustomers.deposit(clusterId, amount);\n    } else {\n      this.logger.info('Depositing extra balance %s to %s for cluster %s', amount, this.signer.address, clusterId);\n      tx = this.blockchain.ddcCustomers.depositExtra(clusterId, amount);\n    }\n\n    return this.blockchain.send(tx, { account: this.signer });\n  }\n\n  /**\n   * Deposits a specified amount of tokens to the target address for a specific cluster.\n   * This allows depositing funds on behalf of another address.\n   *\n   * @param targetAddress - The target address to deposit funds for.\n   * @param clusterId - The ID of the cluster to deposit tokens for.\n   * @param amount - The amount of tokens to deposit.\n   *\n   * @returns A promise that resolves to the transaction hash of the deposit.\n   *\n   * @example\n   *\n   * ```typescript\n   * const targetAddress = '5D5PhZQNJzcJXVBxwJxZcsutjKPqUPydrvpu6HeiBfMae2Qu';\n   * const clusterId: ClusterId = '0x...';\n   * const amount = 100n;\n   * const txHash = await ddcClient.depositBalanceFor(targetAddress, clusterId, amount);\n   *\n   * console.log(txHash);\n   * ```\n   * */\n  async depositBalanceFor(targetAddress: AccountId, clusterId: ClusterId, amount: bigint) {\n    this.logger.info('Depositing balance %s for %s in cluster %s', amount, targetAddress, clusterId);\n    const tx = this.blockchain.ddcCustomers.depositFor(targetAddress, clusterId, amount);\n    return this.blockchain.send(tx, { account: this.signer });\n  }\n\n  /**\n   * Retrieves the current active deposit of the account for a specific cluster.\n   *\n   * @param clusterId - The ID of the cluster to get deposit for.\n   * @param accountId - Optional account ID. If not provided, uses the signer's address.\n   *\n   * @returns A promise that resolves to the current active deposit of the account.\n   *\n   * @example\n   *\n   * ```typescript\n   * const clusterId: ClusterId = '0x...';\n   * const deposit = await ddcClient.getDeposit(clusterId);\n   *\n   * console.log(deposit);\n   * ```\n   * */\n  async getDeposit(clusterId: ClusterId, accountId?: AccountId) {\n    const targetAccountId = accountId || this.signer.address;\n    this.logger.info('Getting the account deposit %s for cluster %s', targetAccountId, clusterId);\n    const info = await this.blockchain.ddcCustomers.getStackingInfo(clusterId, targetAccountId);\n    const deposit = BigInt(info?.active || 0n);\n    this.logger.info('The account (%s) deposit for cluster %s is %s', targetAccountId, clusterId, deposit);\n\n    return deposit;\n  }\n\n  /**\n   * Unlocks deposit funds from the account for the specified cluster.\n   *\n   * @param clusterId - The ID of the cluster.\n   * @param amount - The amount to unlock.\n   *\n   * @returns A promise that resolves to the transaction hash.\n   *\n   * @example\n   *\n   * ```typescript\n   * const clusterId: ClusterId = '0x...';\n   * const amount = 100n;\n   * const txHash = await ddcClient.unlockDeposit(clusterId, amount);\n   *\n   * console.log(txHash);\n   * ```\n   * */\n  async unlockDeposit(clusterId: ClusterId, amount: bigint) {\n    this.logger.info('Unlocking deposit %s for cluster %s', amount, clusterId);\n    const tx = this.blockchain.ddcCustomers.unlockDeposit(clusterId, amount);\n    return this.blockchain.send(tx, { account: this.signer });\n  }\n\n  /**\n   * Withdraws unlocked funds from the account for the specified cluster.\n   *\n   * @param clusterId - The ID of the cluster.\n   *\n   * @returns A promise that resolves to the transaction hash.\n   *\n   * @example\n   *\n   * ```typescript\n   * const clusterId: ClusterId = '0x...';\n   * const txHash = await ddcClient.withdrawUnlockedDeposit(clusterId);\n   *\n   * console.log(txHash);\n   * ```\n   * */\n  async withdrawUnlockedDeposit(clusterId: ClusterId) {\n    this.logger.info('Withdrawing unlocked deposit for cluster %s', clusterId);\n    const tx = this.blockchain.ddcCustomers.withdrawUnlockedDeposit(clusterId);\n    return this.blockchain.send(tx, { account: this.signer });\n  }\n\n  /**\n   * Creates a new bucket on a specified cluster.\n   *\n   * @param clusterId - The ID of the cluster where the bucket will be created.\n   * @param params - Optional parameters for the new bucket. Defaults to an empty object.\n   *                 Currently, the only parameter is `isPublic`, which defaults to `false`.\n   *\n   * @returns A promise that resolves to the ID of the newly created bucket.\n   *\n   * @example\n   *\n   * ```typescript\n   * const clusterId: ClusterId = '0x...';\n   * const bucketId: BucketId = await ddcClient.createBucket(clusterId, {\n   *   isPublic: true,\n   * });\n   * ```\n   */\n  async createBucket(clusterId: ClusterId, params: Partial<BucketParams> = {}) {\n    this.logger.info('Creating bucket on cluster %s', clusterId);\n    const defaultParams: BucketParams = {\n      isPublic: false,\n    };\n\n    const response = await this.blockchain.send(\n      this.blockchain.ddcCustomers.createBucket(clusterId, { ...defaultParams, ...params }),\n      { account: this.signer },\n    );\n\n    const [bucketId] = this.blockchain.ddcCustomers.extractCreatedBucketIds(response.events);\n    this.logger.info('Bucket %s created in cluster %s in TX: %s', bucketId, clusterId, response.txHash);\n\n    return bucketId;\n  }\n\n  /**\n   * Retrieves information about a specific bucket by its ID.\n   *\n   * @param bucketId - The ID of the bucket to retrieve.\n   *\n   * @returns A promise that resolves to the bucket information.\n   *\n   * @example\n   *\n   * ```typescript\n   * const bucketId: BucketId = 1n;\n   * const bucket = await ddcClient.getBucket(bucketId);\n   *\n   * console.log(bucket);\n   * ```\n   */\n  async getBucket(bucketId: BucketId) {\n    this.logger.info('Getting bucket %s', bucketId);\n    const bucket = await this.blockchain.ddcCustomers.getBucket(bucketId);\n    this.logger.info('Got bucket %s', bucketId);\n\n    return bucket;\n  }\n\n  /**\n   * Retrieves a list of all available buckets.\n   *\n   * @returns A promise that resolves to an array of buckets.\n   *\n   * @example\n   *\n   * ```typescript\n   * const buckets = await ddcClient.getBucketList();\n   *\n   * console.log(buckets);\n   * ```\n   */\n  async getBucketList() {\n    this.logger.info('Getting bucket list');\n    const list = await this.blockchain.ddcCustomers.listBuckets();\n    this.logger.info('Got bucket list of lenght %s', list.length);\n\n    return list;\n  }\n\n  /**\n   * Mark existing buckets with specified bucket ids as removed.\n   *\n   * @param bucketIds - The IDs of the buckets to remove.\n   * @returns A promise that resolves to the IDs of the removed buckets.\n   *\n   * @example\n   *\n   * ```typescript\n   * const removedBucketIds = await ddcClient.removeBucket(1, 2, 3);\n   * ```\n   */\n  async removeBuckets(...bucketIds: BucketId[]) {\n    this.logger.info('Removing buckets %s', bucketIds);\n\n    const response = await this.blockchain.send(this.blockchain.ddcCustomers.removeBuckets(...bucketIds), {\n      account: this.signer,\n    });\n\n    const removedBucketIds = this.blockchain.ddcCustomers.extractRemovedBucketIds(response.events);\n    this.logger.info('Buckets %s removed in TX: %s', removedBucketIds, response.txHash);\n\n    return removedBucketIds;\n  }\n\n  /**\n   * @deprecated Use `getBucket` instead\n   */\n  bucketGet(bucketId: BucketId) {\n    return this.getBucket(bucketId);\n  }\n\n  /**\n   * @deprecated Use `getBucketList` instead\n   */\n  bucketList() {\n    return this.getBucketList();\n  }\n\n  /**\n   * Grants access to a bucket to a specific account.\n   *\n   * @param subject - The account ID to grant access to.\n   * @param params - The parameters for the access being granted.\n   *\n   * @returns A new AuthToken that the subject account can use to access the bucket.\n   *\n   * @example\n   *\n   * ```typescript\n   * const subject: AccountId = '0x...';\n   * const authToken = await ddcClient.grantAccess(subject, {\n   *   bucketId: 1n,\n   *   operations: [AuthTokenOperation.GET],\n   * });\n   *\n   * console.log(authToken.toString());\n   * ```\n   */\n  async grantAccess(subject: AccountId, params: Omit<AuthTokenParams, 'subject'>) {\n    this.logger.info('Granting access to account %s', subject);\n    this.logger.debug({ params }, 'Grant access params');\n\n    return new AuthToken({ ...params, subject }).sign(this.signer);\n  }\n\n  /**\n   * Stores a file or DAG node in a specific bucket.\n   *\n   * @param bucketId - The ID of the bucket to store the entity in.\n   * @param entity - The file or DAG node to store.\n   * @param options - Optional parameters for storing the entity.\n   *\n   * @returns A promise that resolves to a URI for the stored entity.\n   *\n   * @throws Will throw an error if the `entity` argument is neither a File nor a DagNode.\n   *\n   * @example\n   *\n   * ```typescript\n   * const bucketId: BucketId = 1n;\n   * const fileContent = ...;\n   * const file: File = new File(fileContent, { size: 1000 });\n   * const fileUri = await ddcClient.store(bucketId, file);\n   *\n   * console.log(fileUri);\n   * ```\n   */\n  async store(bucketId: BucketId, entity: File, options?: FileStoreOptions): Promise<FileUri>;\n  async store(bucketId: BucketId, entity: DagNode, options?: DagNodeStoreOptions): Promise<DagNodeUri>;\n  async store(bucketId: BucketId, entity: File | DagNode, options?: FileStoreOptions | DagNodeStoreOptions) {\n    this.logger.debug({ entity, options }, 'Storing entity');\n\n    if (File.isFile(entity)) {\n      const cid = await this.fileStorage.store(bucketId, entity, options);\n\n      return new FileUri(bucketId, cid, options);\n    }\n\n    if (DagNode.isDagNode(entity)) {\n      const cid = await this.storeDagNode(bucketId, entity, options);\n\n      return new DagNodeUri(bucketId, cid, options);\n    }\n\n    throw new Error('`entity` argument is neither File nor DagNode');\n  }\n\n  private async storeDagNode(bucketId: BucketId, node: DagNode, options?: DagNodeStoreOptions) {\n    return this.ddcNode.storeDagNode(bucketId, node, options);\n  }\n\n  /**\n   * Reads a file or DAG node from a specific URI.\n   *\n   * @param uri - The URI of the file or DAG node to read.\n   * @param options - Optional parameters for reading the entity.\n   *\n   * @returns A promise that resolves to the file or DAG node response.\n   *\n   * @example\n   *\n   * ```typescript\n   * const fileUri = new FileUri(bucketId, cid);\n   * const fileResponse = await ddcClient.read(fileUri);\n   * const textContent = await fileResponse.text();\n   *\n   * console.log(textContent);\n   * ```\n   */\n  async read(uri: FileUri, options?: FileReadOptions): Promise<FileResponse>;\n  async read(uri: DagNodeUri, options?: DagNodeGetOptions): Promise<DagNodeResponse>;\n  async read(uri: DdcUri, options?: FileReadOptions | DagNodeGetOptions) {\n    this.logger.debug({ uri, options }, 'Reading entity');\n\n    if (uri.entity === 'file') {\n      return this.fileStorage.read(uri.bucketId, uri.cidOrName, options as FileReadOptions);\n    }\n\n    if (uri.entity === 'dag-node') {\n      return this.ddcNode.getDagNode(uri.bucketId, uri.cidOrName, options as DagNodeGetOptions);\n    }\n\n    throw new Error('`uri` argument is neither FileUri or DagNodeUri');\n  }\n\n  /**\n   * Resolves a CNS name to a specific CID.\n   *\n   * @param bucketId - The ID of the bucket to resolve the CNS name in.\n   * @param cnsName - The CNS name to resolve.\n   *\n   * @returns A promise that resolves to the CID of the CNS name.\n   *\n   * @example\n   *\n   * ```typescript\n   * const bucketId: BucketId = 1n;\n   * const cnsName = 'my-file';\n   * const cid = await ddcClient.resolveName(bucketId, cnsName);\n   *\n   * console.log(cid);\n   * ```\n   */\n  async resolveName(bucketId: BucketId, cnsName: string, options?: CnsRecordGetOptions) {\n    return this.ddcNode.resolveName(bucketId, cnsName, options);\n  }\n}\n"],"names":["DdcUri","constructor","bucketId","cidOrName","entity","options","cid","name","Cid","isCid","_this$name","Error","FileUri","DagNodeUri","DdcClient","uriOrSigner","config","DEFAULT_PRESET","ddcNode","blockchain","fileStorage","signer","logger","createLogger","Blockchain","wsEndpoint","UriSigner","router","nodes","Router","BalancedNode","FileStorage","debug","logErrors","bindErrorLogger","create","client","connect","isReady","disconnect","getBalance","info","address","balance","getAccountFreeBalance","depositBalance","clusterId","amount","tx","currentDeposit","allowExtra","ddcCustomers","getStackingInfo","deposit","depositExtra","send","account","depositBalanceFor","targetAddress","depositFor","getDeposit","accountId","targetAccountId","BigInt","active","unlockDeposit","withdrawUnlockedDeposit","createBucket","params","defaultParams","isPublic","response","extractCreatedBucketIds","events","txHash","getBucket","bucket","getBucketList","list","listBuckets","length","removeBuckets","bucketIds","removedBucketIds","extractRemovedBucketIds","bucketGet","bucketList","grantAccess","subject","AuthToken","sign","store","File","isFile","DagNode","isDagNode","storeDagNode","node","read","uri","getDagNode","resolveName","cnsName"],"mappings":";;;;AASA;;;;AAIG;MACUA,MAAM,CAAA;EAqBjBC,WAAAA,CAAYC,QAAkB,EAAEC,SAAiB,EAAEC,MAAS,EAAEC,OAAuB,EAAA;AApBrF;;AAEG;IAFH,IAGSC,CAAAA,GAAG,GAAW,EAAE,CAAA;AAEzB;;AAEG;AAFH,IAAA,IAAA,CAGSC,IAAI,GAAA,KAAA,CAAA,CAAA;AAEb;;AAEG;AAFH,IAAA,IAAA,CAGSL,QAAQ,GAAA,KAAA,CAAA,CAAA;AAEjB;;AAEG;AAFH,IAAA,IAAA,CAGSE,MAAM,GAAA,KAAA,CAAA,CAAA;AAGb,IAAA,IAAI,CAACG,IAAI,GAAGF,OAAO,IAAPA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAO,CAAEE,IAAI,CAAA;IACzB,IAAI,CAACL,QAAQ,GAAGA,QAAQ,CAAA;IACxB,IAAI,CAACE,MAAM,GAAGA,MAAM,CAAA;AAEpB,IAAA,IAAII,OAAG,CAACC,KAAK,CAACN,SAAS,CAAC,EAAE;MACxB,IAAI,CAACG,GAAG,GAAGH,SAAS,CAAA;AACtB,KAAC,MAAM;AAAA,MAAA,IAAAO,UAAA,CAAA;MACL,CAAAA,UAAA,GAAI,IAAA,CAACH,IAAI,KAAA,IAAA,GAAAG,UAAA,GAAT,IAAI,CAACH,IAAI,GAAKJ,SAAS,CAAA;AACzB,KAAA;AACF,GAAA;AAEA;;AAEG;EACH,IAAIA,SAASA,GAAA;IACX,MAAMA,SAAS,GAAG,IAAI,CAACG,GAAG,IAAI,IAAI,CAACC,IAAI,CAAA;IAEvC,IAAI,CAACJ,SAAS,EAAE;AACd,MAAA,MAAM,IAAIQ,KAAK,CAAC,6CAA6C,CAAC,CAAA;AAChE,KAAA;AAEA,IAAA,OAAOR,SAAS,CAAA;AAClB,GAAA;AACD,CAAA;AAED;;;;;;;AAOG;AACG,MAAOS,OAAQ,SAAQZ,MAAc,CAAA;AACzCC,EAAAA,WAAAA,CAAYC,QAAkB,EAAEC,SAAiB,EAAEE,OAAuB,EAAA;IACxE,KAAK,CAACH,QAAQ,EAAEC,SAAS,EAAE,MAAM,EAAEE,OAAO,CAAC,CAAA;AAC7C,GAAA;AACD,CAAA;AAED;;;;;;;AAOG;AACG,MAAOQ,UAAW,SAAQb,MAAkB,CAAA;AAChDC,EAAAA,WAAAA,CAAYC,QAAkB,EAAEC,SAAiB,EAAEE,OAAuB,EAAA;IACxE,KAAK,CAACH,QAAQ,EAAEC,SAAS,EAAE,UAAU,EAAEE,OAAO,CAAC,CAAA;AACjD,GAAA;AACD;;ACrDD;;;;AAIG;MACUS,SAAS,CAAA;AAOpBb,EAAAA,WAAYA,CAAAc,WAA4B,EAAEC,MAAA,GAA0BC,kBAAc,EAAA;AAAA,IAAA,IAAA,CANjEC,OAAO,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACPC,UAAU,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACVC,WAAW,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACXC,MAAM,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACNC,MAAM,GAAA,KAAA,CAAA,CAAA;AAGrB,IAAA,MAAMA,MAAM,GAAGC,gBAAY,CAAC,WAAW,EAAEP,MAAM,CAAC,CAAA;IAChD,MAAMG,YAAU,GACd,OAAOH,MAAM,CAACG,UAAU,KAAK,QAAQ,GAAG,IAAIK,qBAAU,CAAC;MAAEC,UAAU,EAAET,MAAM,CAACG,UAAAA;AAAY,KAAA,CAAC,GAAGH,MAAM,CAACG,UAAU,CAAA;AAE/G,IAAA,MAAME,MAAM,GAAG,OAAON,WAAW,KAAK,QAAQ,GAAG,IAAIW,aAAS,CAACX,WAAW,CAAC,GAAGA,WAAW,CAAA;IACzF,MAAMY,MAAM,GAAGX,MAAM,CAACY,KAAK,GACvB,IAAIC,UAAM,CAAC;MAAER,MAAM;MAAEO,KAAK,EAAEZ,MAAM,CAACY,KAAK;AAAEN,MAAAA,MAAAA;KAAQ,CAAC,GACnD,IAAIO,UAAM,CAAC;MAAER,MAAM;kBAAEF,YAAU;AAAEG,MAAAA,MAAAA;AAAQ,KAAA,CAAC,CAAA;IAE9C,IAAI,CAACH,UAAU,GAAGA,YAAU,CAAA;IAC5B,IAAI,CAACE,MAAM,GAAGA,MAAM,CAAA;IACpB,IAAI,CAACC,MAAM,GAAGA,MAAM,CAAA;AACpB,IAAA,IAAI,CAACJ,OAAO,GAAG,IAAIY,gBAAY,CAAC;AAAE,MAAA,GAAGd,MAAM;MAAEW,MAAM;AAAEL,MAAAA,MAAAA;AAAM,KAAE,CAAC,CAAA;AAC9D,IAAA,IAAI,CAACF,WAAW,GAAG,IAAIW,uBAAW,CAACJ,MAAM,EAAE;AAAE,MAAA,GAAGX,MAAM;AAAEM,MAAAA,MAAAA;AAAM,KAAE,CAAC,CAAA;AAEjEA,IAAAA,MAAM,CAACU,KAAK,CAAChB,MAAM,EAAE,mBAAmB,CAAC,CAAA;AAEzC,IAAA,IAAIA,MAAM,CAACiB,SAAS,KAAK,KAAK,EAAE;MAC9BC,mBAAe,CAAC,IAAI,EAAE,IAAI,CAACZ,MAAM,EAAE,CACjC,YAAY,EACZ,gBAAgB,EAChB,YAAY,EACZ,cAAc,EACd,WAAW,EACX,eAAe,EACf,OAAO,EACP,MAAM,EACN,aAAa,CACd,CAAC,CAAA;AACJ,KAAA;AACF,GAAA;AAEA;;;;;;;;;;;;;;;;;;;;AAoBG;AACH,EAAA,aAAaa,MAAMA,CAACpB,WAA4B,EAAEC,SAA0BC,kBAAc,EAAA;IACxF,MAAMmB,MAAM,GAAG,IAAItB,SAAS,CAACC,WAAW,EAAEC,MAAM,CAAC,CAAA;AAEjD,IAAA,OAAOoB,MAAM,CAACC,OAAO,EAAE,CAAA;AACzB,GAAA;EAEA,MAAMA,OAAOA,GAAA;AACX,IAAA,MAAM,IAAI,CAAClB,UAAU,CAACmB,OAAO,EAAE,CAAA;AAE/B,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,MAAMC,UAAUA,GAAA;AACd,IAAA,MAAM,IAAI,CAACpB,UAAU,CAACoB,UAAU,EAAE,CAAA;AAElC,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA;;;;;;;;;;;AAWK;EACL,MAAMC,UAAUA,GAAA;AACd,IAAA,IAAI,CAAClB,MAAM,CAACmB,IAAI,CAAC,gCAAgC,EAAE,IAAI,CAACpB,MAAM,CAACqB,OAAO,CAAC,CAAA;AACvE,IAAA,MAAMC,OAAO,GAAG,MAAM,IAAI,CAACxB,UAAU,CAACyB,qBAAqB,CAAC,IAAI,CAACvB,MAAM,CAACqB,OAAO,CAAC,CAAA;AAChF,IAAA,IAAI,CAACpB,MAAM,CAACmB,IAAI,CAAC,gCAAgC,EAAE,IAAI,CAACpB,MAAM,CAACqB,OAAO,EAAEC,OAAO,CAAC,CAAA;AAEhF,IAAA,OAAOA,OAAO,CAAA;AAChB,GAAA;AAEA;;;;;;;;;;;;;;;;;;AAkBK;EACL,MAAME,cAAcA,CAACC,SAAoB,EAAEC,MAAc,EAAE1C,UAAiC,EAAE,EAAA;AAC5F,IAAA,IAAI2C,EAAY,CAAA;IAChB,MAAMC,cAAc,GAClB5C,OAAO,CAAC6C,UAAU,KAAK,KAAK,GACxB,IAAI,GACJ,MAAM,IAAI,CAAC/B,UAAU,CAACgC,YAAY,CAACC,eAAe,CAACN,SAAS,EAAE,IAAI,CAACzB,MAAM,CAACqB,OAAO,CAAC,CAAA;IAExF,IAAIO,cAAc,KAAK,IAAI,EAAE;AAC3B,MAAA,IAAI,CAAC3B,MAAM,CAACmB,IAAI,CAAC,4CAA4C,EAAEM,MAAM,EAAE,IAAI,CAAC1B,MAAM,CAACqB,OAAO,EAAEI,SAAS,CAAC,CAAA;AACtGE,MAAAA,EAAE,GAAG,IAAI,CAAC7B,UAAU,CAACgC,YAAY,CAACE,OAAO,CAACP,SAAS,EAAEC,MAAM,CAAC,CAAA;AAC9D,KAAC,MAAM;AACL,MAAA,IAAI,CAACzB,MAAM,CAACmB,IAAI,CAAC,kDAAkD,EAAEM,MAAM,EAAE,IAAI,CAAC1B,MAAM,CAACqB,OAAO,EAAEI,SAAS,CAAC,CAAA;AAC5GE,MAAAA,EAAE,GAAG,IAAI,CAAC7B,UAAU,CAACgC,YAAY,CAACG,YAAY,CAACR,SAAS,EAAEC,MAAM,CAAC,CAAA;AACnE,KAAA;AAEA,IAAA,OAAO,IAAI,CAAC5B,UAAU,CAACoC,IAAI,CAACP,EAAE,EAAE;MAAEQ,OAAO,EAAE,IAAI,CAACnC,MAAAA;AAAM,KAAE,CAAC,CAAA;AAC3D,GAAA;AAEA;;;;;;;;;;;;;;;;;;;;AAoBK;AACL,EAAA,MAAMoC,iBAAiBA,CAACC,aAAwB,EAAEZ,SAAoB,EAAEC,MAAc,EAAA;AACpF,IAAA,IAAI,CAACzB,MAAM,CAACmB,IAAI,CAAC,4CAA4C,EAAEM,MAAM,EAAEW,aAAa,EAAEZ,SAAS,CAAC,CAAA;AAChG,IAAA,MAAME,EAAE,GAAG,IAAI,CAAC7B,UAAU,CAACgC,YAAY,CAACQ,UAAU,CAACD,aAAa,EAAEZ,SAAS,EAAEC,MAAM,CAAC,CAAA;AACpF,IAAA,OAAO,IAAI,CAAC5B,UAAU,CAACoC,IAAI,CAACP,EAAE,EAAE;MAAEQ,OAAO,EAAE,IAAI,CAACnC,MAAAA;AAAM,KAAE,CAAC,CAAA;AAC3D,GAAA;AAEA;;;;;;;;;;;;;;;;AAgBK;AACL,EAAA,MAAMuC,UAAUA,CAACd,SAAoB,EAAEe,SAAqB,EAAA;IAC1D,MAAMC,eAAe,GAAGD,SAAS,IAAI,IAAI,CAACxC,MAAM,CAACqB,OAAO,CAAA;IACxD,IAAI,CAACpB,MAAM,CAACmB,IAAI,CAAC,+CAA+C,EAAEqB,eAAe,EAAEhB,SAAS,CAAC,CAAA;AAC7F,IAAA,MAAML,IAAI,GAAG,MAAM,IAAI,CAACtB,UAAU,CAACgC,YAAY,CAACC,eAAe,CAACN,SAAS,EAAEgB,eAAe,CAAC,CAAA;AAC3F,IAAA,MAAMT,OAAO,GAAGU,MAAM,CAAC,CAAAtB,IAAI,IAAJA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,IAAI,CAAEuB,MAAM,KAAI,EAAE,CAAC,CAAA;AAC1C,IAAA,IAAI,CAAC1C,MAAM,CAACmB,IAAI,CAAC,+CAA+C,EAAEqB,eAAe,EAAEhB,SAAS,EAAEO,OAAO,CAAC,CAAA;AAEtG,IAAA,OAAOA,OAAO,CAAA;AAChB,GAAA;AAEA;;;;;;;;;;;;;;;;;AAiBK;AACL,EAAA,MAAMY,aAAaA,CAACnB,SAAoB,EAAEC,MAAc,EAAA;IACtD,IAAI,CAACzB,MAAM,CAACmB,IAAI,CAAC,qCAAqC,EAAEM,MAAM,EAAED,SAAS,CAAC,CAAA;AAC1E,IAAA,MAAME,EAAE,GAAG,IAAI,CAAC7B,UAAU,CAACgC,YAAY,CAACc,aAAa,CAACnB,SAAS,EAAEC,MAAM,CAAC,CAAA;AACxE,IAAA,OAAO,IAAI,CAAC5B,UAAU,CAACoC,IAAI,CAACP,EAAE,EAAE;MAAEQ,OAAO,EAAE,IAAI,CAACnC,MAAAA;AAAM,KAAE,CAAC,CAAA;AAC3D,GAAA;AAEA;;;;;;;;;;;;;;;AAeK;EACL,MAAM6C,uBAAuBA,CAACpB,SAAoB,EAAA;IAChD,IAAI,CAACxB,MAAM,CAACmB,IAAI,CAAC,6CAA6C,EAAEK,SAAS,CAAC,CAAA;IAC1E,MAAME,EAAE,GAAG,IAAI,CAAC7B,UAAU,CAACgC,YAAY,CAACe,uBAAuB,CAACpB,SAAS,CAAC,CAAA;AAC1E,IAAA,OAAO,IAAI,CAAC3B,UAAU,CAACoC,IAAI,CAACP,EAAE,EAAE;MAAEQ,OAAO,EAAE,IAAI,CAACnC,MAAAA;AAAM,KAAE,CAAC,CAAA;AAC3D,GAAA;AAEA;;;;;;;;;;;;;;;;;AAiBG;EACH,MAAM8C,YAAYA,CAACrB,SAAoB,EAAEsB,SAAgC,EAAE,EAAA;IACzE,IAAI,CAAC9C,MAAM,CAACmB,IAAI,CAAC,+BAA+B,EAAEK,SAAS,CAAC,CAAA;AAC5D,IAAA,MAAMuB,aAAa,GAAiB;AAClCC,MAAAA,QAAQ,EAAE,KAAA;KACX,CAAA;AAED,IAAA,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAACpD,UAAU,CAACoC,IAAI,CACzC,IAAI,CAACpC,UAAU,CAACgC,YAAY,CAACgB,YAAY,CAACrB,SAAS,EAAE;AAAE,MAAA,GAAGuB,aAAa;MAAE,GAAGD,MAAAA;KAAQ,CAAC,EACrF;MAAEZ,OAAO,EAAE,IAAI,CAACnC,MAAAA;AAAM,KAAE,CACzB,CAAA;AAED,IAAA,MAAM,CAACnB,QAAQ,CAAC,GAAG,IAAI,CAACiB,UAAU,CAACgC,YAAY,CAACqB,uBAAuB,CAACD,QAAQ,CAACE,MAAM,CAAC,CAAA;AACxF,IAAA,IAAI,CAACnD,MAAM,CAACmB,IAAI,CAAC,2CAA2C,EAAEvC,QAAQ,EAAE4C,SAAS,EAAEyB,QAAQ,CAACG,MAAM,CAAC,CAAA;AAEnG,IAAA,OAAOxE,QAAQ,CAAA;AACjB,GAAA;AAEA;;;;;;;;;;;;;;;AAeG;EACH,MAAMyE,SAASA,CAACzE,QAAkB,EAAA;IAChC,IAAI,CAACoB,MAAM,CAACmB,IAAI,CAAC,mBAAmB,EAAEvC,QAAQ,CAAC,CAAA;AAC/C,IAAA,MAAM0E,MAAM,GAAG,MAAM,IAAI,CAACzD,UAAU,CAACgC,YAAY,CAACwB,SAAS,CAACzE,QAAQ,CAAC,CAAA;IACrE,IAAI,CAACoB,MAAM,CAACmB,IAAI,CAAC,eAAe,EAAEvC,QAAQ,CAAC,CAAA;AAE3C,IAAA,OAAO0E,MAAM,CAAA;AACf,GAAA;AAEA;;;;;;;;;;;;AAYG;EACH,MAAMC,aAAaA,GAAA;AACjB,IAAA,IAAI,CAACvD,MAAM,CAACmB,IAAI,CAAC,qBAAqB,CAAC,CAAA;IACvC,MAAMqC,IAAI,GAAG,MAAM,IAAI,CAAC3D,UAAU,CAACgC,YAAY,CAAC4B,WAAW,EAAE,CAAA;IAC7D,IAAI,CAACzD,MAAM,CAACmB,IAAI,CAAC,8BAA8B,EAAEqC,IAAI,CAACE,MAAM,CAAC,CAAA;AAE7D,IAAA,OAAOF,IAAI,CAAA;AACb,GAAA;AAEA;;;;;;;;;;;AAWG;AACH,EAAA,MAAMG,aAAaA,CAAC,GAAGC,SAAqB,EAAA;IAC1C,IAAI,CAAC5D,MAAM,CAACmB,IAAI,CAAC,qBAAqB,EAAEyC,SAAS,CAAC,CAAA;IAElD,MAAMX,QAAQ,GAAG,MAAM,IAAI,CAACpD,UAAU,CAACoC,IAAI,CAAC,IAAI,CAACpC,UAAU,CAACgC,YAAY,CAAC8B,aAAa,CAAC,GAAGC,SAAS,CAAC,EAAE;MACpG1B,OAAO,EAAE,IAAI,CAACnC,MAAAA;AACf,KAAA,CAAC,CAAA;AAEF,IAAA,MAAM8D,gBAAgB,GAAG,IAAI,CAAChE,UAAU,CAACgC,YAAY,CAACiC,uBAAuB,CAACb,QAAQ,CAACE,MAAM,CAAC,CAAA;AAC9F,IAAA,IAAI,CAACnD,MAAM,CAACmB,IAAI,CAAC,8BAA8B,EAAE0C,gBAAgB,EAAEZ,QAAQ,CAACG,MAAM,CAAC,CAAA;AAEnF,IAAA,OAAOS,gBAAgB,CAAA;AACzB,GAAA;AAEA;;AAEG;EACHE,SAASA,CAACnF,QAAkB,EAAA;AAC1B,IAAA,OAAO,IAAI,CAACyE,SAAS,CAACzE,QAAQ,CAAC,CAAA;AACjC,GAAA;AAEA;;AAEG;AACHoF,EAAAA,UAAUA,GAAA;AACR,IAAA,OAAO,IAAI,CAACT,aAAa,EAAE,CAAA;AAC7B,GAAA;AAEA;;;;;;;;;;;;;;;;;;;AAmBG;AACH,EAAA,MAAMU,WAAWA,CAACC,OAAkB,EAAEpB,MAAwC,EAAA;IAC5E,IAAI,CAAC9C,MAAM,CAACmB,IAAI,CAAC,+BAA+B,EAAE+C,OAAO,CAAC,CAAA;AAC1D,IAAA,IAAI,CAAClE,MAAM,CAACU,KAAK,CAAC;AAAEoC,MAAAA,MAAAA;KAAQ,EAAE,qBAAqB,CAAC,CAAA;IAEpD,OAAO,IAAIqB,aAAS,CAAC;AAAE,MAAA,GAAGrB,MAAM;AAAEoB,MAAAA,OAAAA;AAAS,KAAA,CAAC,CAACE,IAAI,CAAC,IAAI,CAACrE,MAAM,CAAC,CAAA;AAChE,GAAA;AA0BA,EAAA,MAAMsE,KAAKA,CAACzF,QAAkB,EAAEE,MAAsB,EAAEC,OAAgD,EAAA;AACtG,IAAA,IAAI,CAACiB,MAAM,CAACU,KAAK,CAAC;MAAE5B,MAAM;AAAEC,MAAAA,OAAAA;KAAS,EAAE,gBAAgB,CAAC,CAAA;AAExD,IAAA,IAAIuF,gBAAI,CAACC,MAAM,CAACzF,MAAM,CAAC,EAAE;AACvB,MAAA,MAAME,GAAG,GAAG,MAAM,IAAI,CAACc,WAAW,CAACuE,KAAK,CAACzF,QAAQ,EAAEE,MAAM,EAAEC,OAAO,CAAC,CAAA;MAEnE,OAAO,IAAIO,OAAO,CAACV,QAAQ,EAAEI,GAAG,EAAED,OAAO,CAAC,CAAA;AAC5C,KAAA;AAEA,IAAA,IAAIyF,WAAO,CAACC,SAAS,CAAC3F,MAAM,CAAC,EAAE;AAC7B,MAAA,MAAME,GAAG,GAAG,MAAM,IAAI,CAAC0F,YAAY,CAAC9F,QAAQ,EAAEE,MAAM,EAAEC,OAAO,CAAC,CAAA;MAE9D,OAAO,IAAIQ,UAAU,CAACX,QAAQ,EAAEI,GAAG,EAAED,OAAO,CAAC,CAAA;AAC/C,KAAA;AAEA,IAAA,MAAM,IAAIM,KAAK,CAAC,+CAA+C,CAAC,CAAA;AAClE,GAAA;AAEQ,EAAA,MAAMqF,YAAYA,CAAC9F,QAAkB,EAAE+F,IAAa,EAAE5F,OAA6B,EAAA;IACzF,OAAO,IAAI,CAACa,OAAO,CAAC8E,YAAY,CAAC9F,QAAQ,EAAE+F,IAAI,EAAE5F,OAAO,CAAC,CAAA;AAC3D,GAAA;AAsBA,EAAA,MAAM6F,IAAIA,CAACC,GAAW,EAAE9F,OAA6C,EAAA;AACnE,IAAA,IAAI,CAACiB,MAAM,CAACU,KAAK,CAAC;MAAEmE,GAAG;AAAE9F,MAAAA,OAAAA;KAAS,EAAE,gBAAgB,CAAC,CAAA;AAErD,IAAA,IAAI8F,GAAG,CAAC/F,MAAM,KAAK,MAAM,EAAE;AACzB,MAAA,OAAO,IAAI,CAACgB,WAAW,CAAC8E,IAAI,CAACC,GAAG,CAACjG,QAAQ,EAAEiG,GAAG,CAAChG,SAAS,EAAEE,OAA0B,CAAC,CAAA;AACvF,KAAA;AAEA,IAAA,IAAI8F,GAAG,CAAC/F,MAAM,KAAK,UAAU,EAAE;AAC7B,MAAA,OAAO,IAAI,CAACc,OAAO,CAACkF,UAAU,CAACD,GAAG,CAACjG,QAAQ,EAAEiG,GAAG,CAAChG,SAAS,EAAEE,OAA4B,CAAC,CAAA;AAC3F,KAAA;AAEA,IAAA,MAAM,IAAIM,KAAK,CAAC,iDAAiD,CAAC,CAAA;AACpE,GAAA;AAEA;;;;;;;;;;;;;;;;;AAiBG;AACH,EAAA,MAAM0F,WAAWA,CAACnG,QAAkB,EAAEoG,OAAe,EAAEjG,OAA6B,EAAA;IAClF,OAAO,IAAI,CAACa,OAAO,CAACmF,WAAW,CAACnG,QAAQ,EAAEoG,OAAO,EAAEjG,OAAO,CAAC,CAAA;AAC7D,GAAA;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}