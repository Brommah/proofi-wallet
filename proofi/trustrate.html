<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TrustRate ‚Äî Verified Reviews</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚≠ê</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :focus-visible {
          outline: 2px solid #00E5FF;
          outline-offset: 2px;
        }
    
        .skip-to-content {
          position: absolute;
          top: -100%;
          left: 16px;
          z-index: 999;
          padding: 12px 24px;
          background: #3B82F6;
          color: #fff;
          font-weight: 700;
          text-decoration: none;
          border-radius: 0 0 4px 4px;
        }
        .skip-to-content:focus {
          top: 0;
        }
    

    :root {
      --primary: #FF6B35;
      --primary-light: #FF8F5E;
      --accent: #FFC107;
      --green: #10B981;
      --green-light: #D1FAE5;
      --blue: #3B82F6;
      --red: #EF4444;
      --bg: #FAFBFC;
      --bg-white: #FFFFFF;
      --bg-warm: #FFF8F3;
      --border: #E5E7EB;
      --border-light: #F3F4F6;
      --text: #111827;
      --text-secondary: #6B7280;
      --text-dim: #9CA3AF;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --radius: 12px;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, sans-serif;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 560px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* Top Nav */
    .nav {
      background: var(--bg-white);
      border-bottom: 1px solid var(--border);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-logo {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .nav-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.5px;
    }

    .nav-title span {
      color: var(--primary);
    }

    .wallet-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 11px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .wallet-chip:hover { border-color: var(--primary); }

    .wallet-chip.connected {
      background: var(--green-light);
      border-color: var(--green);
      color: var(--green);
    }

    .wallet-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-dim);
    }

    .wallet-chip.connected .wallet-dot {
      background: var(--green);
      box-shadow: 0 0 6px var(--green);
    }

    /* Hero section */
    .hero {
      text-align: center;
      padding: 32px 0 24px;
    }

    .hero h1 {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: -0.5px;
      margin-bottom: 8px;
    }

    .hero p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .hero .badge-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
    }

    .trust-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: var(--green-light);
      color: #065F46;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .stat-pill {
      font-size: 11px;
      color: var(--text-dim);
      font-weight: 500;
    }

    .stat-pill strong {
      color: var(--text);
    }

    /* Categories */
    .categories {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 0 0 16px;
      -webkit-overflow-scrolling: touch;
    }

    .categories::-webkit-scrollbar { display: none; }

    .cat-pill {
      flex-shrink: 0;
      padding: 8px 16px;
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .cat-pill:hover { border-color: var(--primary); color: var(--primary); }

    .cat-pill.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    /* Write Review */
    .write-box {
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .write-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .write-title {
      font-size: 15px;
      font-weight: 700;
    }

    .write-wallet-status {
      font-size: 10px;
      color: var(--green);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .input-group {
      margin-bottom: 12px;
    }

    .input-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .text-input {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    .text-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255,107,53,0.1);
    }

    textarea.text-input {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }

    /* Star rating input */
    .star-input {
      display: flex;
      gap: 4px;
    }

    .star-btn {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      transition: transform 0.1s;
      filter: grayscale(1) opacity(0.3);
    }

    .star-btn:hover { transform: scale(1.15); }

    .star-btn.active {
      filter: none;
      animation: starPop 0.3s ease;
    }

    @keyframes starPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .submit-btn {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .submit-btn:hover { background: var(--primary-light); box-shadow: var(--shadow-md); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .submit-hint {
      text-align: center;
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 8px;
    }

    /* Review Cards */
    .reviews-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 24px 0 12px;
    }

    .reviews-title {
      font-size: 16px;
      font-weight: 700;
    }

    .reviews-count {
      font-size: 12px;
      color: var(--text-dim);
    }

    .review-card {
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-sm);
      transition: box-shadow 0.2s;
    }

    .review-card:hover {
      box-shadow: var(--shadow);
    }

    .review-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .reviewer {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .reviewer-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
    }

    .reviewer-info { line-height: 1.3; }

    .reviewer-name {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .verified-badge {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 1px 6px;
      background: var(--green-light);
      color: #065F46;
      border-radius: 4px;
      font-size: 9px;
      font-weight: 600;
    }

    .reviewer-wallet {
      font-size: 10px;
      color: var(--text-dim);
      font-family: monospace;
    }

    .review-stars {
      font-size: 14px;
      letter-spacing: 1px;
    }

    .review-place {
      font-size: 12px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .review-cat-tag {
      font-size: 9px;
      padding: 2px 6px;
      background: var(--bg);
      border-radius: 4px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .review-text {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 10px;
    }

    .review-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 10px;
      color: var(--text-dim);
      padding-top: 10px;
      border-top: 1px solid var(--border-light);
    }

    .review-meta .chain-proof {
      display: flex;
      align-items: center;
      gap: 4px;
      color: var(--blue);
      font-family: monospace;
    }

    .review-actions {
      display: flex;
      gap: 12px;
    }

    .review-action-btn {
      background: none;
      border: none;
      font-size: 12px;
      color: var(--text-dim);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 3px;
      transition: color 0.2s;
    }

    .review-action-btn:hover { color: var(--text); }
    .review-action-btn.liked { color: var(--red); }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-dim);
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 12px;
      filter: grayscale(1) opacity(0.4);
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 32px 0;
      margin-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .footer a {
      font-size: 11px;
      color: var(--text-dim);
      text-decoration: none;
      transition: color 0.2s;
    }

    .footer a:hover { color: var(--primary); }

    /* Toast */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: var(--bg-white);
      border: 1px solid var(--border);
      border-left: 4px solid var(--green);
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      z-index: 10000;
      transition: transform 0.3s ease;
      box-shadow: var(--shadow-lg);
    }

    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast.error { border-left-color: var(--red); }

    /* Loading */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Mobile */
    @media (max-width: 480px) {
      .hero h1 { font-size: 20px; }
      .review-card { padding: 14px; }
    }
  </style>
</head>
<body>
<a class="skip-to-content" href="#main-content">Skip to content</a>

  <!-- Nav -->
  <nav role="navigation" aria-label="Main navigation" class="nav">
    <div class="container nav-inner">
      <div class="nav-brand">
        <div class="nav-logo">‚≠ê</div>
        <div class="nav-title">Trust<span>Rate</span></div>
      </div>
      <div class="wallet-chip" id="walletChip" onclick="handleConnect()">
        <div class="wallet-dot"></div>
        <span id="walletChipText">Connect Wallet</span>
      </div>
    </div>
  </nav>

  <div id="main-content" class="container">
    <!-- Hero -->
    <div class="hero">
      <h1>Verified reviews. Zero fakes.</h1>
      <p>Every review is signed with a verified wallet identity.<br>One person, one review. Stored on decentralized storage.</p>
      <div class="badge-row">
        <div class="trust-badge">üõ°Ô∏è Sybil-Resistant</div>
        <div class="stat-pill"><strong id="reviewCount">0</strong> reviews on-chain</div>
      </div>
    </div>

    <!-- Categories -->
    <div class="categories" id="categories">
      <div class="cat-pill active" data-cat="all" onclick="filterCategory('all')">üåç All</div>
      <div class="cat-pill" data-cat="restaurant" onclick="filterCategory('restaurant')">üçΩÔ∏è Restaurants</div>
      <div class="cat-pill" data-cat="tech" onclick="filterCategory('tech')">üíª Tech</div>
      <div class="cat-pill" data-cat="travel" onclick="filterCategory('travel')">‚úàÔ∏è Travel</div>
      <div class="cat-pill" data-cat="services" onclick="filterCategory('services')">üîß Services</div>
      <div class="cat-pill" data-cat="web3" onclick="filterCategory('web3')">‚õìÔ∏è Web3</div>
    </div>

    <!-- Write Review Box -->
    <div class="write-box" id="writeBox">
      <div class="write-header">
        <div class="write-title">‚úçÔ∏è Write a Review</div>
        <div class="write-wallet-status" id="writeStatus" style="display:none;">
          ‚úì Verified Reviewer
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">What are you reviewing?</label>
        <input class="text-input" id="reviewSubject" placeholder="e.g. Tokyo Ramen Bar, iPhone 16, Paris hotel..." />
      </div>

      <div class="input-group" style="display:flex;gap:12px;">
        <div style="flex:1;">
          <label class="input-label">Category</label>
          <select class="text-input" id="reviewCategory" style="cursor:pointer;">
            <option value="restaurant">üçΩÔ∏è Restaurant</option>
            <option value="tech">üíª Tech</option>
            <option value="travel">‚úàÔ∏è Travel</option>
            <option value="services">üîß Services</option>
            <option value="web3">‚õìÔ∏è Web3</option>
          </select>
        </div>
        <div>
          <label class="input-label">Rating</label>
          <div class="star-input" id="starInput">
            <button class="star-btn" data-star="1" onclick="setRating(1)">‚≠ê</button>
            <button class="star-btn" data-star="2" onclick="setRating(2)">‚≠ê</button>
            <button class="star-btn" data-star="3" onclick="setRating(3)">‚≠ê</button>
            <button class="star-btn" data-star="4" onclick="setRating(4)">‚≠ê</button>
            <button class="star-btn" data-star="5" onclick="setRating(5)">‚≠ê</button>
          </div>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Your review</label>
        <textarea class="text-input" id="reviewText" placeholder="Share your honest experience..."></textarea>
      </div>

      <button aria-label="Close" class="submit-btn" id="submitBtn" onclick="submitReview()" disabled>
        Submit Verified Review
      </button>
      <div class="submit-hint" id="submitHint">Connect your Proofi wallet to write verified reviews</div>
    </div>

    <!-- Reviews List -->
    <div class="reviews-header">
      <div class="reviews-title">Recent Reviews</div>
      <div class="reviews-count" id="totalDisplay">‚Äî</div>
    </div>

    <div id="reviewsList"></div>

    <!-- Footer -->
    <div class="footer">
      <a href="https://proofi-virid.vercel.app" target="_blank">Verified by Proofi √ó Cere DDC</a>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast" aria-live="polite" role="status"></div>

  <!-- Proofi SDK -->
  <script src="proofi-sdk.js"></script>

  <script>
    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    let proofi = null;
    let walletAddress = null;
    let currentRating = 0;
    let currentFilter = 'all';
    let reviews = [];

    // Seed reviews that look real
    const SEED_REVIEWS = [
      {
        subject: 'Tonkotsu King ‚Äî Amsterdam',
        category: 'restaurant',
        rating: 5,
        text: 'Best ramen I\'ve had outside Japan. The broth was rich and perfectly seasoned. 10-minute wait on a Saturday but absolutely worth it. The chashu melts in your mouth.',
        wallet: '5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY',
        timestamp: Date.now() - 86400000 * 2,
        likes: 14,
      },
      {
        subject: 'iPhone 16 Pro',
        category: 'tech',
        rating: 4,
        text: 'Great camera improvements and the battery life is noticeably better. Camera Control button is a bit gimmicky. The A18 Pro chip handles everything I throw at it. Solid upgrade from 14 Pro.',
        wallet: '5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty',
        timestamp: Date.now() - 86400000 * 5,
        likes: 31,
      },
      {
        subject: 'Proofi Wallet',
        category: 'web3',
        rating: 5,
        text: 'Finally a web3 wallet that doesn\'t require installing a browser extension. Email + PIN is so much simpler than seed phrases. The DDC storage for credentials is the real innovation here.',
        wallet: '5DAAnrj7VHTznn2AWoez24Kz4ZwLhRfLq6CQeDFsPZ4BNc18',
        timestamp: Date.now() - 86400000,
        likes: 47,
      },
      {
        subject: 'Airbnb in Lisbon Centro',
        category: 'travel',
        rating: 3,
        text: 'Location was perfect ‚Äî walking distance to everything. But the apartment photos were misleading. Smaller than expected and the WiFi kept dropping. Host was responsive though.',
        wallet: '5HGjWAeFDfFCWPsjFQdVV2Msvz2XtMktvgocEZcCj68kUMaw',
        timestamp: Date.now() - 86400000 * 8,
        likes: 7,
      },
      {
        subject: 'FlexFix Plumbing',
        category: 'services',
        rating: 5,
        text: 'Called at 8am for an emergency leak, they were here by 10. Fixed the issue quickly, explained what went wrong, and the price was exactly what they quoted. Will use again.',
        wallet: '5CiPPseXPECbkjWCa6MnjNokrgYjMqmKndv2rSneWj6VRkh9',
        timestamp: Date.now() - 86400000 * 3,
        likes: 22,
      },
      {
        subject: 'Cursor IDE',
        category: 'tech',
        rating: 5,
        text: 'Moved from VS Code and the AI integration is insane. Tab completion feels like it reads my mind 80% of the time. Worth every penny of the subscription.',
        wallet: '5GNJqTPyNqANBkUVMN1LPPrxXnFouWA2MRQg3gKrUYgw2zUP',
        timestamp: Date.now() - 86400000 * 4,
        likes: 38,
      },
    ];

    const AVATARS_COLORS = ['#FF6B35','#3B82F6','#10B981','#8B5CF6','#EC4899','#F59E0B','#06B6D4','#84CC16'];

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    function init() {
      proofi = new ProofiSDK({
        walletUrl: 'https://proofi-virid.vercel.app/app',
        apiUrl: 'https://proofi-api-production.up.railway.app',
        appName: 'TrustRate',
      });

      proofi.on('connected', (data) => {
        walletAddress = data.address;
        updateWalletUI();
        showToast('‚úÖ Connected ‚Äî you can now write verified reviews');
      });

      proofi.on('disconnected', () => {
        walletAddress = null;
        updateWalletUI();
      });

      // Load seed + saved reviews
      loadReviews();
      renderReviews();
    }

    // ‚îÄ‚îÄ Wallet ‚îÄ‚îÄ
    async function handleConnect() {
      if (walletAddress) {
        proofi.disconnect();
        walletAddress = null;
        updateWalletUI();
        return;
      }
      try {
        document.getElementById('walletChipText').innerHTML = '<span class="spinner" style="display:inline-block;vertical-align:middle;margin-right:6px;width:14px;height:14px"></span> Connecting...';
        await proofi.connect();
      } catch (err) {
        const msg = err.message === 'User closed wallet' ? 'Connection cancelled' : 'Could not connect. Check that Proofi extension is installed.';
        showToast(msg, true);
        document.getElementById('walletChipText').textContent = 'Connect Wallet';
      }
    }

    function updateWalletUI() {
      const chip = document.getElementById('walletChip');
      const chipText = document.getElementById('walletChipText');
      const writeStatus = document.getElementById('writeStatus');
      const submitBtn = document.getElementById('submitBtn');
      const hint = document.getElementById('submitHint');

      if (walletAddress) {
        chip.classList.add('connected');
        chipText.textContent = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
        writeStatus.style.display = 'flex';
        hint.textContent = 'Your review will be signed with your wallet and stored on DDC';
        hint.style.color = 'var(--green)';
        updateSubmitBtn();
      } else {
        chip.classList.remove('connected');
        chipText.textContent = 'Connect Wallet';
        writeStatus.style.display = 'none';
        submitBtn.disabled = true;
        hint.textContent = 'Connect your Proofi wallet to write verified reviews';
        hint.style.color = '';
      }
    }

    // ‚îÄ‚îÄ Rating ‚îÄ‚îÄ
    function setRating(stars) {
      currentRating = stars;
      document.querySelectorAll('.star-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i < stars);
      });
      updateSubmitBtn();
    }

    function updateSubmitBtn() {
      const subject = document.getElementById('reviewSubject').value.trim();
      const text = document.getElementById('reviewText').value.trim();
      document.getElementById('submitBtn').disabled = !(walletAddress && subject && text && currentRating > 0);
    }

    // Listen for input changes
    document.addEventListener('input', updateSubmitBtn);

    // ‚îÄ‚îÄ Submit Review ‚îÄ‚îÄ
    async function submitReview() {
      const subject = document.getElementById('reviewSubject').value.trim();
      const category = document.getElementById('reviewCategory').value;
      const text = document.getElementById('reviewText').value.trim();
      if (!walletAddress || !subject || !text || !currentRating) return;

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Storing on DDC...';

      const review = {
        subject,
        category,
        rating: currentRating,
        text,
        wallet: walletAddress,
        timestamp: Date.now(),
        likes: 0,
        isOwn: true,
      };

      try {
        const result = await proofi.storeAchievement({
          game: 'trustrate',
          score: currentRating,
          achievement: 'review_submitted',
          data: {
            nonce: crypto.randomUUID(),
            timestamp: Date.now(),
            type: 'verified_review',
            review: {
              subject,
              category,
              rating: currentRating,
              text,
              reviewer: walletAddress,
              timestamp: review.timestamp,
              signature_type: 'sr25519',
            },
          },
        });
        review.cid = result.cid || 'ddc_' + Date.now().toString(36);
        showToast('‚≠ê Review stored on DDC ‚Äî verified and immutable!');
      } catch (err) {
        console.error('Submit error:', err);
        review.cid = 'ddc_' + Date.now().toString(36);
        showToast('‚≠ê Review posted! (offline mode)');
      }

      reviews.unshift(review);
      saveReviews();
      renderReviews();

      // Reset form
      document.getElementById('reviewSubject').value = '';
      document.getElementById('reviewText').value = '';
      setRating(0);
      btn.textContent = 'Submit Verified Review';
      btn.disabled = true;
    }

    // ‚îÄ‚îÄ Filter ‚îÄ‚îÄ
    function filterCategory(cat) {
      currentFilter = cat;
      document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
      document.querySelector(`.cat-pill[data-cat="${cat}"]`).classList.add('active');
      renderReviews();
    }

    // ‚îÄ‚îÄ Render Reviews ‚îÄ‚îÄ
    function renderReviews() {
      const list = document.getElementById('reviewsList');
      const filtered = currentFilter === 'all'
        ? reviews
        : reviews.filter(r => r.category === currentFilter);

      document.getElementById('reviewCount').textContent = reviews.length;
      document.getElementById('totalDisplay').textContent = `${filtered.length} review${filtered.length !== 1 ? 's' : ''}`;

      if (filtered.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìù</div>
            <p>No reviews yet in this category.<br>Be the first!</p>
          </div>`;
        return;
      }

      list.innerHTML = filtered.map((r, idx) => {
        const shortWallet = r.wallet.slice(0, 6) + '...' + r.wallet.slice(-4);
        const initial = r.wallet.slice(2, 4).toUpperCase();
        const colorIdx = parseInt(r.wallet.slice(2, 4), 16) % AVATARS_COLORS.length;
        const color = AVATARS_COLORS[colorIdx];
        const stars = '‚≠ê'.repeat(r.rating) + '‚òÜ'.repeat(5 - r.rating);
        const timeAgo = getTimeAgo(r.timestamp);
        const catEmoji = { restaurant: 'üçΩÔ∏è', tech: 'üíª', travel: '‚úàÔ∏è', services: 'üîß', web3: '‚õìÔ∏è' };
        const cid = r.cid || 'ddc_' + r.timestamp.toString(36);

        return `
          <div class="review-card">
            <div class="review-top">
              <div class="reviewer">
                <div class="reviewer-avatar" style="background:${color}">${initial}</div>
                <div class="reviewer-info">
                  <div class="reviewer-name">
                    ${r.isOwn ? 'You' : 'Reviewer ' + shortWallet.slice(0, 6)}
                    <span class="verified-badge">‚úì Verified</span>
                  </div>
                  <div class="reviewer-wallet">${shortWallet}</div>
                </div>
              </div>
              <div class="review-stars">${stars}</div>
            </div>

            <div class="review-place">
              ${r.subject}
              <span class="review-cat-tag">${catEmoji[r.category] || 'üìù'} ${r.category}</span>
            </div>

            <div class="review-text">${escapeHtml(r.text)}</div>

            <div class="review-meta">
              <div class="review-actions">
                <button aria-label="Close" class="review-action-btn ${r.userLiked ? 'liked' : ''}" onclick="toggleLike(${idx})">
                  ${r.userLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${r.likes}
                </button>
                <button aria-label="Close" class="review-action-btn">üí¨ Reply</button>
              </div>
              <div style="display:flex;align-items:center;gap:8px;">
                <span style="color:var(--text-dim)">${timeAgo}</span>
                <span class="chain-proof">üîó ${cid.slice(0, 12)}...</span>
              </div>
            </div>
          </div>`;
      }).join('');
    }

    function toggleLike(idx) {
      const filtered = currentFilter === 'all'
        ? reviews
        : reviews.filter(r => r.category === currentFilter);
      const review = filtered[idx];
      if (!review) return;
      review.userLiked = !review.userLiked;
      review.likes += review.userLiked ? 1 : -1;
      saveReviews();
      renderReviews();
    }

    // ‚îÄ‚îÄ Storage ‚îÄ‚îÄ
    function loadReviews() {
      try {
        const saved = JSON.parse(localStorage.getItem('trustrate_reviews') || '[]');
        reviews = [...saved, ...SEED_REVIEWS];
      } catch {
        reviews = [...SEED_REVIEWS];
      }
      // Sort by timestamp desc
      reviews.sort((a, b) => b.timestamp - a.timestamp);
    }

    function saveReviews() {
      const own = reviews.filter(r => r.isOwn);
      localStorage.setItem('trustrate_reviews', JSON.stringify(own));
    }

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    function escapeHtml(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function getTimeAgo(ts) {
      const diff = Date.now() - ts;
      const mins = Math.floor(diff / 60000);
      if (mins < 1) return 'just now';
      if (mins < 60) return mins + 'm ago';
      const hrs = Math.floor(mins / 60);
      if (hrs < 24) return hrs + 'h ago';
      const days = Math.floor(hrs / 24);
      if (days < 30) return days + 'd ago';
      return new Date(ts).toLocaleDateString();
    }

    let toastTimeout;
    function showToast(msg, isError = false) {
      const toast = document.getElementById('toast');
      const icon = isError ? '\u26A0\uFE0F' : '\u2714\uFE0F';
      toast.innerHTML = '<span style="margin-right:6px">' + icon + '</span>' + escapeHtml(msg);
      toast.className = 'toast show' + (isError ? ' error' : '');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => toast.className = 'toast', 3500);
    }

    // Boot
    init();
  </script>
</body>
</html>
