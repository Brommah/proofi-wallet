<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkillBadge ‚Äî Prove Your Knowledge</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--violet:#00E5FF;--indigo:#00E5FF;--pink:#FF3366;--cyan:#00E5FF;--amber:#FFB800;--bg:#000000;--surface:#0A0A0A;--card:#111111;--border:#1A1A1A;--text:#F0F0F0;--dim:#555555}
    body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;min-height:100vh}
    body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 50% -20%,rgba(0,229,255,0.04) 0%,transparent 60%);pointer-events:none}
    .container{max-width:520px;margin:0 auto;padding:16px}
    .header{text-align:center;padding:20px 0 16px}
    .logo{font-size:28px;font-weight:800;background:linear-gradient(135deg,#00E5FF,#00FF88);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .tagline{font-size:11px;color:var(--dim);letter-spacing:1px;margin-top:2px}
    .wallet-bar{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:2px;margin-bottom:16px}
    .wallet-bar.connected{border-color:var(--violet);box-shadow:0 0 20px rgba(139,92,246,0.1)}
    .wl{font-size:9px;color:var(--dim);letter-spacing:1px;text-transform:uppercase}.wa{font-size:11px;color:var(--violet);font-family:monospace}
    .btn{font-family:'Inter',sans-serif;font-weight:700;font-size:12px;padding:10px 18px;border:2px solid var(--violet);background:transparent;color:var(--violet);border-radius:2px;cursor:pointer;transition:all .2s}
    .btn:hover{background:var(--violet);color:#fff;box-shadow:0 0 15px rgba(0,229,255,0.3)}
    .btn.sm{padding:7px 14px;font-size:10px}
    .btn.pink{border-color:var(--pink);color:var(--pink)}.btn.pink:hover{background:var(--pink);color:#fff}
    .btn.red{border-color:#FF3366;color:#FF3366}.btn.red:hover{background:#FF3366;color:#fff}
    .btn.amber{border-color:var(--amber);color:var(--amber)}.btn.amber:hover{background:var(--amber);color:var(--bg)}
    .btn:disabled{opacity:.3;cursor:not-allowed}
    .topic-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px}
    .topic-card{background:var(--surface);border:2px solid var(--border);border-radius:2px;padding:18px 14px;text-align:center;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
    .topic-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 60%,rgba(139,92,246,0.05));opacity:0;transition:opacity .3s}
    .topic-card:hover{border-color:var(--violet);transform:translateY(-2px)}.topic-card:hover::before{opacity:1}
    .topic-card .icon{font-size:36px;display:block;margin-bottom:8px}
    .topic-card .name{font-weight:700;font-size:14px;margin-bottom:3px}
    .topic-card .desc{font-size:10px;color:var(--dim)}
    .topic-card .difficulty{font-size:9px;padding:3px 8px;border-radius:2px;display:inline-block;margin-top:6px}
    .diff-easy{background:rgba(6,182,212,0.15);color:var(--cyan)}
    .diff-med{background:rgba(245,158,11,0.15);color:var(--amber)}
    .diff-hard{background:rgba(236,72,153,0.15);color:var(--pink)}
    .quiz-container{background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:20px;margin-bottom:16px}
    .quiz-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .quiz-progress{font-size:11px;color:var(--dim)}
    .quiz-score{font-size:11px;color:var(--violet);font-weight:700}
    .progress-bar{height:4px;background:var(--border);border-radius:2px;margin-bottom:16px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--violet),var(--pink));transition:width .4s;border-radius:2px}
    .question{font-size:16px;font-weight:700;margin-bottom:16px;line-height:1.5}
    .answers{display:flex;flex-direction:column;gap:8px}
    .answer{padding:12px 14px;background:var(--card);border:2px solid var(--border);border-radius:2px;cursor:pointer;transition:all .2s;font-size:13px}
    .answer:hover{border-color:var(--violet);background:rgba(139,92,246,0.05)}
    .answer.correct{border-color:#00FF88;background:rgba(16,185,129,0.1);color:#00FF88}
    .answer.wrong{border-color:#FF3366;background:rgba(239,68,68,0.1);color:#FF3366}
    .answer.disabled{pointer-events:none;opacity:.6}
    .result-container{text-align:center;padding:30px 20px}
    .result-score{font-size:48px;font-weight:800;background:linear-gradient(135deg,#00E5FF,#00FF88);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .result-label{font-size:14px;color:var(--dim);margin-bottom:4px}
    .result-grade{font-size:20px;font-weight:700;margin-top:8px}
    .badge-visual{width:100px;height:100px;margin:16px auto;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:48px;position:relative}
    .badge-visual::before{content:'';position:absolute;inset:-4px;border-radius:50%;border:3px solid;animation:badgeGlow 2s ease-in-out infinite}
    @keyframes badgeGlow{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.03)}}
    .badges-section{background:var(--surface);border:1px solid var(--border);border-radius:2px;padding:16px;margin-bottom:16px}
    .badges-title{font-size:14px;font-weight:700;margin-bottom:12px}
    .badge-list{display:flex;flex-wrap:wrap;gap:8px}
    .earned-badge{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:2px;transition:border-color .2s}
    .earned-badge:hover{border-color:var(--violet)}
    .earned-badge .icon{font-size:20px}
    .earned-badge .info .name{font-size:11px;font-weight:700}
    .earned-badge .info .meta{font-size:9px;color:var(--dim)}
    .earned-badge .chain{font-size:8px;padding:2px 6px;background:rgba(139,92,246,0.1);color:var(--violet);border:1px solid rgba(139,92,246,0.3);border-radius:4px;margin-left:auto}
    .footer{text-align:center;padding:20px 0;border-top:1px solid var(--border);margin-top:8px}
    .footer a{color:var(--dim);text-decoration:none;font-size:9px;letter-spacing:2px;text-transform:uppercase}.footer a:hover{color:var(--violet)}
    .toast{position:fixed;top:16px;left:50%;transform:translateX(-50%) translateY(-80px);background:var(--surface);border:2px solid var(--violet);border-radius:2px;padding:10px 20px;font-size:11px;color:var(--violet);z-index:10000;transition:transform .3s;box-shadow:0 4px 20px rgba(0,0,0,0.4)}
    .toast.show{transform:translateX(-50%) translateY(0)}.toast.error{border-color:#FF3366;color:#FF3366}
    #quizView,#resultView{display:none}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">üéì SkillBadge</div>
      <div class="tagline">Take a quiz ‚Ä¢ Earn verifiable credentials</div>
    </div>
    <div class="wallet-bar" id="walletBar">
      <div><div class="wl">Proofi Wallet</div><div class="wa" id="walletAddr">Not connected</div></div>
      <div style="display:flex;gap:6px;">
        <button class="btn sm" id="connectBtn" onclick="handleConnect()">CONNECT</button>
        <button class="btn sm" id="demoBtn" onclick="enterDemoMode()" style="border-color:#00FF88;color:#00FF88;">TRY DEMO</button>
      </div>
    </div>

    <!-- Topic Selection -->
    <div id="topicView">
      <div class="topic-grid" id="topicGrid"></div>
    </div>

    <!-- Quiz -->
    <div id="quizView">
      <div class="quiz-container" id="quizBox">
        <div class="quiz-header">
          <span class="quiz-progress" id="qProgress">Question 1/5</span>
          <span class="quiz-score" id="qScore">Score: 0</span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
        <div class="question" id="qText"></div>
        <div class="answers" id="qAnswers"></div>
      </div>
    </div>

    <!-- Result -->
    <div id="resultView">
      <div class="quiz-container">
        <div class="result-container" id="resultContent"></div>
      </div>
    </div>

    <!-- Earned Badges -->
    <div class="badges-section">
      <div class="badges-title">üèÖ Your Badges</div>
      <div class="badge-list" id="badgeList">
        <div style="color:var(--dim);font-size:12px;padding:10px">Complete quizzes to earn badges</div>
      </div>
    </div>

    <div class="footer"><a href="https://proofi-virid.vercel.app" target="_blank">‚ö° Powered by Proofi √ó Cere DDC</a></div>
  </div>
  <div class="toast" id="toast"></div>

  <script src="https://proofi-virid.vercel.app/proofi-sdk.js"></script>
  <script>
    const TOPICS = [
      { id:'js', name:'JavaScript', icon:'üíõ', desc:'ES6+, closures, async', diff:'Medium', diffClass:'diff-med',
        questions:[
          {q:'What does `typeof null` return?',a:['object','null','undefined','number'],c:0},
          {q:'Which method creates a new array from calling a function on every element?',a:['forEach','filter','map','reduce'],c:2},
          {q:"What is the output of `[...'hello']`?",a:['["hello"]','["h","e","l","l","o"]','Error','undefined'],c:1},
          {q:'Which keyword declares a block-scoped variable?',a:['var','let','both','neither'],c:1},
          {q:'What does `Promise.all` return if one promise rejects?',a:['All results','First resolved','Rejected promise','undefined'],c:2},
        ]},
      { id:'python', name:'Python', icon:'üêç', desc:'Syntax, data types, OOP', diff:'Easy', diffClass:'diff-easy',
        questions:[
          {q:'What is the output of `len("hello")`?',a:['4','5','6','Error'],c:1},
          {q:'Which data type is immutable?',a:['list','dict','tuple','set'],c:2},
          {q:'What does `//` operator do?',a:['Comment','Division','Floor division','Power'],c:2},
          {q:'How do you create a list comprehension?',a:['[x for x in range(5)]','list(range(5))','Both work','Neither'],c:0},
          {q:'What is `self` in a class method?',a:['Keyword','Reference to instance','Global var','Module name'],c:1},
        ]},
      { id:'design', name:'UI Design', icon:'üé®', desc:'Principles, UX, typography', diff:'Easy', diffClass:'diff-easy',
        questions:[
          {q:'What is the ideal line length for reading?',a:['20-40 chars','45-75 chars','80-120 chars','No limit'],c:1},
          {q:'Which principle states related items should be grouped?',a:['Contrast','Proximity','Repetition','Alignment'],c:1},
          {q:'What does "above the fold" mean?',a:['Top navigation','Visible without scrolling','Header area','Logo placement'],c:1},
          {q:'Which color model is used for screens?',a:['CMYK','RGB','Pantone','HSL only'],c:1},
          {q:'What is a design system?',a:['Color palette','Reusable component library','Wireframe','Prototype'],c:1},
        ]},
      { id:'web3', name:'Web3 & Crypto', icon:'‚õìÔ∏è', desc:'Blockchain, wallets, DeFi', diff:'Hard', diffClass:'diff-hard',
        questions:[
          {q:'What is a nonce in blockchain?',a:['Random number','Sequential counter','Hash value','Block ID'],c:1},
          {q:'What consensus does Ethereum use post-merge?',a:['Proof of Work','Proof of Stake','Proof of Authority','DPoS'],c:1},
          {q:'What is DDC in the Cere ecosystem?',a:['Digital Data Currency','Decentralized Data Cloud','Distributed Database Cluster','Data Delivery Chain'],c:1},
          {q:'What is a verifiable credential?',a:['NFT','Tamper-proof digital claim','Smart contract','Token'],c:1},
          {q:'What does "self-sovereign identity" mean?',a:['Government ID','User controls own identity','Corporate identity','Anonymous browsing'],c:1},
        ]},
    ];

    let proofi, walletAddress, isDemoMode = false;
    let currentTopic = null, currentQ = 0, score = 0, answered = false;
    let badges = JSON.parse(localStorage.getItem('sb_badges') || '[]');

    function init() {
      proofi = new ProofiSDK({ appName: 'SkillBadge' });
      proofi.on('connected', d => { walletAddress = d.address; updateWalletUI(); toast('Wallet connected!'); });
      proofi.on('disconnected', () => { walletAddress = null; updateWalletUI(); });
      renderTopics();
      renderBadges();
    }

    function renderTopics() {
      document.getElementById('topicGrid').innerHTML = TOPICS.map(t => `
        <div class="topic-card" onclick="startQuiz('${t.id}')">
          <span class="icon">${t.icon}</span>
          <div class="name">${t.name}</div>
          <div class="desc">${t.desc}</div>
          <span class="difficulty ${t.diffClass}">${t.diff}</span>
        </div>
      `).join('');
    }

    function startQuiz(id) {
      currentTopic = TOPICS.find(t => t.id === id);
      currentQ = 0; score = 0; answered = false;
      document.getElementById('topicView').style.display = 'none';
      document.getElementById('resultView').style.display = 'none';
      document.getElementById('quizView').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      const q = currentTopic.questions[currentQ];
      const total = currentTopic.questions.length;
      document.getElementById('qProgress').textContent = `Question ${currentQ+1}/${total}`;
      document.getElementById('qScore').textContent = `Score: ${score}`;
      document.getElementById('progressFill').style.width = ((currentQ/total)*100)+'%';
      document.getElementById('qText').textContent = q.q;
      answered = false;
      document.getElementById('qAnswers').innerHTML = q.a.map((a, i) =>
        `<div class="answer" onclick="selectAnswer(${i})" id="ans-${i}">${a}</div>`
      ).join('');
    }

    function selectAnswer(idx) {
      if (answered) return;
      answered = true;
      const q = currentTopic.questions[currentQ];
      const correct = q.c;
      document.getElementById('ans-'+correct).classList.add('correct');
      if (idx === correct) { score++; document.getElementById('qScore').textContent = `Score: ${score}`; }
      else { document.getElementById('ans-'+idx).classList.add('wrong'); }
      document.querySelectorAll('.answer').forEach(a => a.classList.add('disabled'));

      setTimeout(() => {
        currentQ++;
        if (currentQ < currentTopic.questions.length) showQuestion();
        else showResult();
      }, 1200);
    }

    async function showResult() {
      document.getElementById('quizView').style.display = 'none';
      document.getElementById('resultView').style.display = 'block';
      const total = currentTopic.questions.length;
      const pct = Math.round((score/total)*100);
      const passed = pct >= 60;
      const grade = pct >= 90 ? 'A+' : pct >= 80 ? 'A' : pct >= 70 ? 'B' : pct >= 60 ? 'C' : 'F';
      const gradeColor = pct >= 80 ? 'var(--violet)' : pct >= 60 ? 'var(--amber)' : '#FF3366';

      let badgeHtml = '';
      if (passed) {
        const badge = { topic: currentTopic.id, name: currentTopic.name, icon: currentTopic.icon, score: pct, grade, date: new Date().toISOString(), onChain: false };

        if (walletAddress) {
          try {
            await proofi.storeAchievement({ game: 'skillbadge', score: pct, achievement: `${currentTopic.id}-${grade}`, data: { nonce: crypto.randomUUID(), timestamp: Date.now(), topic: currentTopic.name, score: pct, grade, questions: total, correct: score } });
            badge.onChain = true;
            toast(`üéì ${currentTopic.name} badge stored on DDC!`);
          } catch (e) { toast(e.message, true); }
        }

        badges.push(badge);
        localStorage.setItem('sb_badges', JSON.stringify(badges));
        renderBadges();

        badgeHtml = `
          <div class="badge-visual" style="background:linear-gradient(135deg,rgba(139,92,246,0.2),rgba(236,72,153,0.2));border:2px solid var(--violet)">
            <span style="position:relative;z-index:1">${currentTopic.icon}</span>
          </div>
          <div style="color:var(--violet);font-size:12px;font-weight:700;margin-bottom:12px">Badge Earned!</div>`;
      }

      document.getElementById('resultContent').innerHTML = `
        <div class="result-label">Quiz Complete!</div>
        <div class="result-score">${pct}%</div>
        <div class="result-grade" style="color:${gradeColor}">Grade: ${grade}</div>
        <div style="font-size:12px;color:var(--dim);margin:8px 0">${score}/${total} correct answers</div>
        ${badgeHtml}
        <div style="display:flex;gap:8px;margin-top:16px">
          <button class="btn pink" style="flex:1" onclick="startQuiz('${currentTopic.id}')">Retry</button>
          <button class="btn" style="flex:1" onclick="backToTopics()">Topics</button>
        </div>`;
    }

    function backToTopics() {
      document.getElementById('quizView').style.display = 'none';
      document.getElementById('resultView').style.display = 'none';
      document.getElementById('topicView').style.display = 'block';
    }

    function renderBadges() {
      const list = document.getElementById('badgeList');
      if (!badges.length) { list.innerHTML = '<div style="color:var(--dim);font-size:12px;padding:10px">Complete quizzes to earn badges</div>'; return; }
      list.innerHTML = badges.map(b => `
        <div class="earned-badge">
          <span class="icon">${b.icon}</span>
          <div class="info"><div class="name">${b.name}</div><div class="meta">${b.grade} ‚Ä¢ ${b.score}%</div></div>
          ${b.onChain ? '<span class="chain">ON-CHAIN</span>' : ''}
        </div>
      `).join('');
    }

    function enterDemoMode() {
      isDemoMode = true;
      walletAddress = '5Demo' + Math.random().toString(36).slice(2, 14) + 'ABCDEF';
      updateWalletUI();
      toast('üéì Demo mode ‚Äî take quizzes freely!');
    }
    async function handleConnect() {
      if (walletAddress) { proofi.disconnect(); walletAddress = null; isDemoMode = false; updateWalletUI(); return; }
      try { document.getElementById('connectBtn').textContent = '...'; await proofi.connect(); } catch(e) { const msg = e.message === 'User closed wallet' ? 'Cancelled' : 'Could not connect ‚Äî try demo mode'; toast(msg, true); document.getElementById('connectBtn').textContent = 'CONNECT'; }
    }
    function updateWalletUI() {
      const bar=document.getElementById('walletBar'),addr=document.getElementById('walletAddr'),btn=document.getElementById('connectBtn');
      if(walletAddress){bar.classList.add('connected');addr.textContent=(isDemoMode?'üéÆ ':'')+ walletAddress.slice(0,6)+'...'+walletAddress.slice(-4);btn.textContent='DISCONNECT';btn.className='btn sm red';document.getElementById('demoBtn').style.display='none'}
      else{bar.classList.remove('connected');addr.textContent='Not connected';btn.textContent='CONNECT';btn.className='btn sm';document.getElementById('demoBtn').style.display=''}
    }
    let tt;function toast(m,e=false){const t=document.getElementById('toast');t.textContent=m;t.className='toast show'+(e?' error':'');clearTimeout(tt);tt=setTimeout(()=>t.className='toast',3000)}
    // Auto-connect from Proofi Chrome extension
    function checkExtensionConnect() {
      if (window.__proofi_extension__?.connected && window.__proofi_extension__?.address) {
        walletAddress = window.__proofi_extension__.address;
        // Sync token to localStorage so SDK API calls work
        if (window.__proofi_extension__.token) {
          try { localStorage.setItem('proofi_token', window.__proofi_extension__.token); } catch(e) {}
        }
        // Also sync with ProofiSDK so storeAchievement() works
        if (typeof proofi !== 'undefined') {
          proofi.address = walletAddress;
          proofi.connected = true;
        }
        updateWalletUI();
        toast('WALLET CONNECTED VIA EXTENSION');
      }
    }
    checkExtensionConnect();
    window.addEventListener('proofi-extension-ready', checkExtensionConnect);

    init();
  </script>
</body>
</html>
