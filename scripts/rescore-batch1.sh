#!/bin/bash
# Re-score 50 candidates via HR pipeline API
# Each call takes ~30s, total ~25 minutes

RESULTS_FILE="/Users/martijnbroersma/clawd/reports/gemini3-rescore-batch1.jsonl"
mkdir -p /Users/martijnbroersma/clawd/reports
> "$RESULTS_FILE"

API="https://hr-funnel-monitor-production.up.railway.app/api/reevaluate"

declare -a IDS=(
"2f3d8000-83d6-81ff-b59f-f6ce2515e2c5"
"2f3d8000-83d6-812d-8e0a-e28f6002e0c0"
"2f4d8000-83d6-81f1-8fc4-f0d1e809fb50"
"2f4d8000-83d6-815e-ac79-fe21b18f4b42"
"2f4d8000-83d6-8133-8160-e08628b00637"
"2f4d8000-83d6-81f7-b326-e6e137247efa"
"2f4d8000-83d6-81ff-be45-c6f8a16121aa"
"2f6d8000-83d6-8167-8e52-d6c390f032d9"
"2f6d8000-83d6-8175-864b-ff2f6bfdb4a1"
"2f6d8000-83d6-815a-9d8e-dcfc71240fcd"
"2f6d8000-83d6-8116-8370-f931f2ffeb9f"
"2f6d8000-83d6-81d0-9fb7-e983b282b22f"
"2f6d8000-83d6-8177-b9ca-fb68448d8394"
"2f6d8000-83d6-8114-90dd-f9992f1f38cb"
"2f3d8000-83d6-8125-b3f8-e12454a0bc94"
"2f4d8000-83d6-8148-8fb5-d1d532c6c41d"
"2f6d8000-83d6-8179-8645-ddf87d5e2a76"
"2f6d8000-83d6-8132-bda1-d5fa78b48579"
"2f6d8000-83d6-8179-af5e-f54a0ec7db23"
"2f6d8000-83d6-8177-8a9f-cef750f8129e"
"2edd8000-83d6-81d0-bff1-e513dd67f2ba"
"2e7d8000-83d6-807d-bc27-c0b59dbe8d9e"
"2f1d8000-83d6-808b-ae95-e716bd9702fb"
"2ecd8000-83d6-81ce-ae78-f7bd5ce1d539"
"2b5d8000-83d6-81aa-b4ee-c58eb1133327"
"2b2d8000-83d6-81e0-a384-c3a877b424f6"
"2abd8000-83d6-806d-886d-f2bf4c7fc4dc"
"2a9d8000-83d6-81c9-b7ca-ee5d32b186a5"
"2a0d8000-83d6-8128-8218-cb4394750476"
"29dd8000-83d6-8190-b205-d2000769b3f7"
"27dd8000-83d6-812f-9d3e-dd87edc84412"
"277d8000-83d6-81c6-ba30-f2c99d20ea89"
"24ed8000-83d6-8000-b7c0-df2f30afb5b7"
"24cd8000-83d6-80fe-9958-d83771738ee0"
"249d8000-83d6-80fb-ba22-d262e777bc11"
"246d8000-83d6-81a6-a7ce-eb69a85da936"
"242d8000-83d6-81b2-a4c6-fe7d2bec6001"
"241d8000-83d6-8187-8777-c4a66d2eef78"
"241d8000-83d6-808c-84c7-f060ead28a1a"
"23cd8000-83d6-81b7-89d9-d311a2a91762"
"1dfd8000-83d6-8041-9a70-d961220900fc"
"1ddd8000-83d6-811d-820f-f6be1e5a49e5"
"1d6d8000-83d6-8000-b648-eb7f0354c184"
"1c9d8000-83d6-80c9-bbf3-cc1cef25cf56"
"270d8000-83d6-8172-b469-f974b6f71490"
"270d8000-83d6-8162-b600-edc1000e4d4a"
"270d8000-83d6-815e-8b31-f9265785c7ff"
"270d8000-83d6-815c-b9b0-cd7f9642bd0e"
"270d8000-83d6-8121-bb2b-fc3f9ac6cf17"
"26fd8000-83d6-81f3-9909-ffe915d67643"
)

declare -a NAMES=(
"Konstantin Zhivotov"
"Preeti Parihar"
"Akarsh Reddy Tatimakula"
"Nash Ashworth"
"Ajith Vemuri"
"Pavan Thota"
"Chandrakant Bagewadi"
"Cedric Ogire"
"Manuel"
"Rajkumar"
"Dhieddine Barhoumi"
"Hany Almnaem"
"Leticia Azevedo"
"Sravanthi Reddy"
"Haochen Li"
"Kirandevraj R"
"Abhineet Pandey"
"S Kabir"
"Tilek Maksatbekov"
"Marcel Hadwiger"
"Lukas Walliser"
"Haichuan Wei (Arthur)"
"Melvin Tercan"
"Zakaria Saif"
"Ayush Bajpai"
"Kiran Devihosur"
"Naman Patel"
"Matthew Work"
"Joep Gommers"
"Yi Mao"
"Deepti Ahlawat"
"Venkatesh Ramavath"
"Farah Fatima"
"Khachatur Gharibyan"
"Jacob Rafati"
"Maksym Ivashchenko"
"Avimukta Malakar"
"Julianna Kulesova"
"Lisa Lomadze"
"Dunja Maria Darmer"
"Juan Paulino Garcia"
"Sash Saseetharran"
"Jonathon Ong"
"Arnav Wadhwa"
"Ken Wu"
"Lamiaa Maguerra"
"Ken Wu"
"Jayati Chandra"
"Jayati Chandra"
"Moheeb Ahmed"
)

declare -a ROLES=(
"AI Innovator"
"AI Innovator"
"AI Engineer"
"AI Innovator"
"Principal Fullstack Engineer"
"AI Innovator"
"Principal Fullstack Engineer"
"Blockchain Engineer"
"AI Engineer"
"AI Engineer"
"AI Engineer"
"AI Engineer"
"AI Engineer"
"AI Engineer"
"AI Innovator"
"AI Innovator"
"AI Engineer"
"AI Engineer"
"Founder's Associate (Business Ops)"
"Founder's Associate (Business Ops)"
"Founder's Associate (Business Ops)"
"AI Innovator"
"AI Innovator"
"Blockchain Engineer"
"AI Innovator"
"AI Innovator"
"Principal Fullstack Engineer"
"AI Innovator"
"AI Innovator"
"Principal Fullstack Engineer"
"AI Engineer"
"AI Engineer"
""
"Principal Fullstack Engineer"
"AI Innovator"
"Principal Fullstack Engineer"
""
""
""
""
"AI Innovator"
"AI Innovator"
"AI Innovator"
"AI Innovator"
"Founder's Associate"
"Founder's Associate"
"Founder's Associate"
"Founder's Associate"
"Founder's Associate"
"Founder's Associate"
)

TOTAL=${#IDS[@]}
echo "Starting re-score of $TOTAL candidates..."
echo "Started at: $(date)"

for i in "${!IDS[@]}"; do
    ID="${IDS[$i]}"
    NAME="${NAMES[$i]}"
    ROLE="${ROLES[$i]}"
    NUM=$((i + 1))
    
    echo "[$NUM/$TOTAL] Processing: $NAME ($ROLE) - $ID"
    
    RESPONSE=$(curl -s -w "\n%{http_code}" -X POST "$API/$ID" \
        -H "Content-Type: application/json" \
        --max-time 120)
    
    HTTP_CODE=$(echo "$RESPONSE" | tail -1)
    BODY=$(echo "$RESPONSE" | sed '$d')
    
    # Extract old and new scores from response
    OLD_SCORE=$(echo "$BODY" | python3 -c "import json,sys; d=json.load(sys.stdin); print(d.get('oldScore', d.get('old_score', 'N/A')))" 2>/dev/null || echo "N/A")
    NEW_SCORE=$(echo "$BODY" | python3 -c "import json,sys; d=json.load(sys.stdin); print(d.get('newScore', d.get('new_score', d.get('score', 'N/A')))" 2>/dev/null || echo "N/A")
    
    echo "  â†’ HTTP $HTTP_CODE | Old: $OLD_SCORE | New: $NEW_SCORE"
    
    # Save to JSONL
    echo "{\"idx\":$NUM,\"id\":\"$ID\",\"name\":\"$NAME\",\"role\":\"$ROLE\",\"http\":$HTTP_CODE,\"old_score\":\"$OLD_SCORE\",\"new_score\":\"$NEW_SCORE\",\"response\":$(echo "$BODY" | python3 -c "import json,sys; print(json.dumps(sys.stdin.read()))" 2>/dev/null || echo "\"\"")}" >> "$RESULTS_FILE"
done

echo ""
echo "Completed at: $(date)"
echo "Results saved to: $RESULTS_FILE"
